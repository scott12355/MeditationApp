<?xml version="1.0" encoding="utf-8" ?>
<uranium:UraniumContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                            xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                            xmlns:controls="clr-namespace:MeditationApp.Controls"
                            xmlns:behaviors="clr-namespace:MeditationApp.Behaviors"
                            xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
                            xmlns:converters="clr-namespace:MeditationApp.Converters"
                            xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
                            xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
                            x:Class="MeditationApp.Views.TodayPage"
                            Title="Today"
                            Shell.NavBarIsVisible="False">
    <ContentPage.Padding>
        <OnPlatform x:TypeArguments="Thickness">
            <On Platform="iOS"
                    Value="0,0,0,-30"/>
            <On Platform="Android"
                    Value="0,0,0,20"/>
        </OnPlatform>
    </ContentPage.Padding>

    <uranium:UraniumContentPage.Resources>
        <!-- Converters -->
        <converters:BoolToOpacityConverter x:Key="BoolToOpacityConverter"/>
        <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>
        <converters:MoodToEmojiConverter x:Key="MoodToEmojiConverter"/>
        <converters:MoodSelectorVisibilityConverter x:Key="MoodSelectorVisibilityConverter"/>
        <converters:SessionCompletedVisibilityConverter x:Key="SessionCompletedVisibilityConverter"/>
        <converters:StatusToColorConverter x:Key="StatusToColorConverter"/>
        <converters:StatusToBackgroundColorConverter x:Key="StatusToBackgroundColorConverter"/>
        <converters:StatusToBoolConverter x:Key="StatusToBoolConverter"/>
        <converters:StringToBoolConverter x:Key="StringToBoolConverter"/>
        <converters:BoolToPlayPauseConverter x:Key="BoolToPlayPauseConverter"/>


        <!-- DataTemplates -->
        <DataTemplate x:Key="SessionItemTemplate">
            <Frame Padding="10"
                   CornerRadius="10"
                   BackgroundColor="{StaticResource GlassyWhite}"
                   BorderColor="{StaticResource GlassyBorder}"
                   HasShadow="True">
                <VerticalStackLayout Spacing="10">
                    <Label Text="{Binding Title}"
                           FontAttributes="Bold"
                           HorizontalOptions="Start"
                           TextColor="Black"/>
                    <Label Text="{Binding Description}"
                           FontSize="14"
                           HorizontalOptions="Start"
                           TextColor="Gray"/>
                    <Label Text="{Binding Date, StringFormat='{}{0:MMMM dd, yyyy}'}"
                           FontSize="12"
                           HorizontalOptions="Start"
                           TextColor="Gray"/>
                </VerticalStackLayout>
            </Frame>
        </DataTemplate>
    </uranium:UraniumContentPage.Resources>

    <uranium:UraniumContentPage.Background>
        <SolidColorBrush Color="#EFEBD3"/>
    </uranium:UraniumContentPage.Background>



    <Grid BackgroundColor="#EFEBD3">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>


        <!-- Main content -->
        <ScrollView Grid.Row="0"
                    x:Name="MainScrollView"
                    Padding="0,0,0,30">
            <VerticalStackLayout Padding="20,0,20,90"
                                 Spacing="20">

                <!-- Header with Hamburger Menu -->
                <Grid Padding="0,20,0,0">
                    <Button x:Name="HamburgerButton"
                            Text="☰"
                            FontSize="24"
                            BackgroundColor="Transparent"
                            TextColor="Black"
                            WidthRequest="44"
                            HeightRequest="44"
                            HorizontalOptions="Start"
                            VerticalOptions="Start"
                            Clicked="OnHamburgerClicked"/>

                    <Label Text="Today"
                           FontSize="28"
                           FontAttributes="Bold"
                           TextColor="Black"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"/>
                </Grid>

                <!-- Header Section -->
                <!-- <VerticalStackLayout Spacing="10"> -->
                <!--     ~1~ <Label Text="{Binding FormattedDate}" @1@ -->
                <!--     ~1~        Style="{StaticResource SubHeadline}" @1@ -->
                <!--     ~1~        HorizontalOptions="Center" @1@ -->
                <!--     ~1~        TextColor="Black"/> @1@ -->
                <!--     ~1~ <Label Text="{Binding WelcomeMessage}" @1@ -->
                <!--     ~1~        Style="{StaticResource Headline}" @1@ -->
                <!--     ~1~        HorizontalOptions="Center"/> @1@ -->
                <!-- </VerticalStackLayout> -->

                <!-- Mood Selector -->
                <VerticalStackLayout Spacing="10"
                                     Padding="0,0,0,-10">
                    <Label Text="How are you feeling today?"
                           HorizontalOptions="Center"
                           FontAttributes="Bold"
                           FontSize="16"
                           MinimumHeightRequest="20"
                           MaximumHeightRequest="20"
                           InputTransparent="True"
                           TextColor="Black">
                        <Label.Opacity>
                            <MultiBinding Converter="{StaticResource MoodSelectorVisibilityConverter}"
                                          ConverterParameter="opacity">
                                <Binding Path="IsMoodSelectorExpanded"/>
                                <Binding Path="SelectedMood"/>
                            </MultiBinding>
                        </Label.Opacity>
                    </Label>


                    <!-- Expandable Mood Selector -->
                    <VerticalStackLayout x:Name="MoodSelectorContainer"
                                         HorizontalOptions="Center"
                                         Spacing="10"
                                         HeightRequest="90"
                                         VerticalOptions="Start">

                        <!-- Collapsed State: Single Selected Emoji -->
                        <Frame x:Name="CollapsedMoodFrame"
                               Padding="0"
                               WidthRequest="56"
                               HeightRequest="56"
                               CornerRadius="28"
                               BackgroundColor="{StaticResource GlassyWhite}"
                               HasShadow="False"
                               VerticalOptions="Center"
                               HorizontalOptions="Center"
                               BorderColor="{StaticResource ActionBlue}">
                            <Frame.IsVisible>
                                <MultiBinding Converter="{StaticResource MoodSelectorVisibilityConverter}"
                                              ConverterParameter="collapsed">
                                    <Binding Path="IsMoodSelectorExpanded"/>
                                    <Binding Path="SelectedMood"/>
                                </MultiBinding>
                            </Frame.IsVisible>
                            <Button Text="{Binding SelectedMood, Converter={StaticResource MoodToEmojiConverter}}"
                                    Command="{Binding ToggleMoodSelectorCommand}"
                                    BackgroundColor="Transparent"
                                    FontSize="28"
                                    WidthRequest="56"
                                    HeightRequest="56"
                                    Padding="0"
                                    BorderColor="Transparent">
                                <VisualStateManager.VisualStateGroups>
                                    <VisualStateGroupList>
                                        <VisualStateGroup x:Name="CommonStates">
                                            <VisualState x:Name="Normal"/>
                                            <VisualState x:Name="Pressed">
                                                <VisualState.Setters>
                                                    <Setter Property="BackgroundColor"
                                                            Value="Transparent"/>
                                                    <Setter Property="BorderColor"
                                                            Value="Transparent"/>
                                                </VisualState.Setters>
                                            </VisualState>
                                        </VisualStateGroup>
                                    </VisualStateGroupList>
                                </VisualStateManager.VisualStateGroups>
                            </Button>
                        </Frame>

                        <!-- Expanded State: All Emoji Options -->
                        <VerticalStackLayout x:Name="ExpandedMoodSelector"
                                             Spacing="10"
                                             VerticalOptions="Start">
                            <VerticalStackLayout.IsVisible>
                                <MultiBinding Converter="{StaticResource MoodSelectorVisibilityConverter}"
                                              ConverterParameter="expanded">
                                    <Binding Path="IsMoodSelectorExpanded"/>
                                    <Binding Path="SelectedMood"/>
                                </MultiBinding>
                            </VerticalStackLayout.IsVisible>
                            <HorizontalStackLayout HorizontalOptions="Center"
                                                   Spacing="15">
                                <!-- Very Low -->
                                <VerticalStackLayout Spacing="4"
                                                     HorizontalOptions="Center"
                                                     VerticalOptions="End">
                                    <Frame Padding="0"
                                           WidthRequest="56"
                                           HeightRequest="56"
                                           CornerRadius="28"
                                           BackgroundColor="{StaticResource GlassyWhite}"
                                           HasShadow="False"
                                           VerticalOptions="Center"
                                           HorizontalOptions="Center"
                                           BorderColor="{StaticResource GlassyBorder}">
                                        <Frame.Triggers>
                                            <DataTrigger TargetType="Frame"
                                                         Binding="{Binding SelectedMood}"
                                                         Value="1">
                                                <Setter Property="BorderColor"
                                                        Value="{StaticResource ActionBlue}"/>
                                            </DataTrigger>
                                        </Frame.Triggers>
                                        <Button Text="😞"
                                                Command="{Binding SelectMoodCommand}"
                                                CommandParameter="1"
                                                BackgroundColor="Transparent"
                                                FontSize="28"
                                                WidthRequest="56"
                                                HeightRequest="56"
                                                Padding="0"
                                                BorderColor="Transparent">
                                            <VisualStateManager.VisualStateGroups>
                                                <VisualStateGroupList>
                                                    <VisualStateGroup x:Name="CommonStates">
                                                        <VisualState x:Name="Normal"/>
                                                        <VisualState x:Name="Pressed">
                                                            <VisualState.Setters>
                                                                <Setter Property="BackgroundColor"
                                                                        Value="Transparent"/>
                                                                <Setter Property="BorderColor"
                                                                        Value="Transparent"/>
                                                            </VisualState.Setters>
                                                        </VisualState>
                                                    </VisualStateGroup>
                                                </VisualStateGroupList>
                                            </VisualStateManager.VisualStateGroups>
                                        </Button>
                                    </Frame>
                                    <Label Text="Very Low"
                                           FontSize="11"
                                           HorizontalOptions="Center"
                                           TextColor="Gray"/>
                                </VerticalStackLayout>

                                <!-- Low -->
                                <VerticalStackLayout Spacing="4"
                                                     HorizontalOptions="Center"
                                                     VerticalOptions="End">
                                    <Frame Padding="0"
                                           WidthRequest="56"
                                           HeightRequest="56"
                                           CornerRadius="28"
                                           BackgroundColor="{StaticResource GlassyWhite}"
                                           HasShadow="False"
                                           VerticalOptions="Center"
                                           HorizontalOptions="Center"
                                           BorderColor="{StaticResource GlassyBorder}">
                                        <Frame.Triggers>
                                            <DataTrigger TargetType="Frame"
                                                         Binding="{Binding SelectedMood}"
                                                         Value="2">
                                                <Setter Property="BorderColor"
                                                        Value="{StaticResource ActionBlue}"/>
                                            </DataTrigger>
                                        </Frame.Triggers>
                                        <Button Text="😕"
                                                Command="{Binding SelectMoodCommand}"
                                                CommandParameter="2"
                                                BackgroundColor="Transparent"
                                                FontSize="28"
                                                WidthRequest="56"
                                                HeightRequest="56"
                                                Padding="0"
                                                BorderColor="Transparent">
                                            <VisualStateManager.VisualStateGroups>
                                                <VisualStateGroupList>
                                                    <VisualStateGroup x:Name="CommonStates">
                                                        <VisualState x:Name="Normal"/>
                                                        <VisualState x:Name="Pressed">
                                                            <VisualState.Setters>
                                                                <Setter Property="BackgroundColor"
                                                                        Value="Transparent"/>
                                                                <Setter Property="BorderColor"
                                                                        Value="Transparent"/>
                                                            </VisualState.Setters>
                                                        </VisualState>
                                                    </VisualStateGroup>
                                                </VisualStateGroupList>
                                            </VisualStateManager.VisualStateGroups>
                                        </Button>
                                    </Frame>
                                    <Label Text="Low"
                                           FontSize="11"
                                           HorizontalOptions="Center"
                                           TextColor="Gray"/>
                                </VerticalStackLayout>

                                <!-- Okay -->
                                <VerticalStackLayout Spacing="4"
                                                     HorizontalOptions="Center"
                                                     VerticalOptions="End">
                                    <Frame Padding="0"
                                           WidthRequest="56"
                                           HeightRequest="56"
                                           CornerRadius="28"
                                           BackgroundColor="{StaticResource GlassyWhite}"
                                           HasShadow="False"
                                           VerticalOptions="Center"
                                           HorizontalOptions="Center"
                                           BorderColor="{StaticResource GlassyBorder}">
                                        <Frame.Triggers>
                                            <DataTrigger TargetType="Frame"
                                                         Binding="{Binding SelectedMood}"
                                                         Value="3">
                                                <Setter Property="BorderColor"
                                                        Value="{StaticResource ActionBlue}"/>
                                            </DataTrigger>
                                        </Frame.Triggers>
                                        <Button Text="😐"
                                                Command="{Binding SelectMoodCommand}"
                                                CommandParameter="3"
                                                BackgroundColor="Transparent"
                                                FontSize="28"
                                                WidthRequest="56"
                                                HeightRequest="56"
                                                Padding="0"
                                                BorderColor="Transparent">
                                            <VisualStateManager.VisualStateGroups>
                                                <VisualStateGroupList>
                                                    <VisualStateGroup x:Name="CommonStates">
                                                        <VisualState x:Name="Normal"/>
                                                        <VisualState x:Name="Pressed">
                                                            <VisualState.Setters>
                                                                <Setter Property="BackgroundColor"
                                                                        Value="Transparent"/>
                                                                <Setter Property="BorderColor"
                                                                        Value="Transparent"/>
                                                            </VisualState.Setters>
                                                        </VisualState>
                                                    </VisualStateGroup>
                                                </VisualStateGroupList>
                                            </VisualStateManager.VisualStateGroups>
                                        </Button>
                                    </Frame>
                                    <Label Text="Okay"
                                           FontSize="11"
                                           HorizontalOptions="Center"
                                           TextColor="Gray"/>
                                </VerticalStackLayout>

                                <!-- Good -->
                                <VerticalStackLayout Spacing="4"
                                                     HorizontalOptions="Center"
                                                     VerticalOptions="End">
                                    <Frame Padding="0"
                                           WidthRequest="56"
                                           HeightRequest="56"
                                           CornerRadius="28"
                                           BackgroundColor="{StaticResource GlassyWhite}"
                                           HasShadow="False"
                                           VerticalOptions="Center"
                                           HorizontalOptions="Center"
                                           BorderColor="{StaticResource GlassyBorder}">
                                        <Frame.Triggers>
                                            <DataTrigger TargetType="Frame"
                                                         Binding="{Binding SelectedMood}"
                                                         Value="4">
                                                <Setter Property="BorderColor"
                                                        Value="{StaticResource ActionBlue}"/>
                                            </DataTrigger>
                                        </Frame.Triggers>
                                        <Button Text="🙂"
                                                Command="{Binding SelectMoodCommand}"
                                                CommandParameter="4"
                                                BackgroundColor="Transparent"
                                                FontSize="28"
                                                WidthRequest="56"
                                                HeightRequest="56"
                                                Padding="0"
                                                BorderColor="Transparent">
                                            <VisualStateManager.VisualStateGroups>
                                                <VisualStateGroupList>
                                                    <VisualStateGroup x:Name="CommonStates">
                                                        <VisualState x:Name="Normal"/>
                                                        <VisualState x:Name="Pressed">
                                                            <VisualState.Setters>
                                                                <Setter Property="BackgroundColor"
                                                                        Value="Transparent"/>
                                                                <Setter Property="BorderColor"
                                                                        Value="Transparent"/>
                                                            </VisualState.Setters>
                                                        </VisualState>
                                                    </VisualStateGroup>
                                                </VisualStateGroupList>
                                            </VisualStateManager.VisualStateGroups>
                                        </Button>
                                    </Frame>
                                    <Label Text="Good"
                                           FontSize="11"
                                           HorizontalOptions="Center"
                                           TextColor="Gray"/>
                                </VerticalStackLayout>

                                <!-- Great -->
                                <VerticalStackLayout Spacing="4"
                                                     HorizontalOptions="Center"
                                                     VerticalOptions="End">
                                    <Frame Padding="0"
                                           WidthRequest="56"
                                           HeightRequest="56"
                                           CornerRadius="28"
                                           BackgroundColor="{StaticResource GlassyWhite}"
                                           HasShadow="False"
                                           VerticalOptions="Center"
                                           HorizontalOptions="Center"
                                           BorderColor="{StaticResource GlassyBorder}">
                                        <Frame.Triggers>
                                            <DataTrigger TargetType="Frame"
                                                         Binding="{Binding SelectedMood}"
                                                         Value="5">
                                                <Setter Property="BorderColor"
                                                        Value="{StaticResource ActionBlue}"/>
                                            </DataTrigger>
                                        </Frame.Triggers>
                                        <Button Text="😃"
                                                Command="{Binding SelectMoodCommand}"
                                                CommandParameter="5"
                                                BackgroundColor="Transparent"
                                                FontSize="28"
                                                WidthRequest="56"
                                                HeightRequest="56"
                                                Padding="0"
                                                BorderColor="Transparent">
                                            <VisualStateManager.VisualStateGroups>
                                                <VisualStateGroupList>
                                                    <VisualStateGroup x:Name="CommonStates">
                                                        <VisualState x:Name="Normal"/>
                                                        <VisualState x:Name="Pressed">
                                                            <VisualState.Setters>
                                                                <Setter Property="BackgroundColor"
                                                                        Value="Transparent"/>
                                                                <Setter Property="BorderColor"
                                                                        Value="Transparent"/>
                                                            </VisualState.Setters>
                                                        </VisualState>
                                                    </VisualStateGroup>
                                                </VisualStateGroupList>
                                            </VisualStateManager.VisualStateGroups>
                                        </Button>
                                    </Frame>
                                    <Label Text="Great"
                                           FontSize="11"
                                           HorizontalOptions="Center"
                                           TextColor="Gray"/>
                                </VerticalStackLayout>
                            </HorizontalStackLayout>
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </VerticalStackLayout>

                <!-- Today's Session Content -->
                <VerticalStackLayout Spacing="20">


                    <!-- If there's a session for today -->
                    <VerticalStackLayout Spacing="15"
                                         IsVisible="{Binding HasTodaySession}">

                        <!-- Enhanced Frame with glassmorphism styling for session states -->
                        <Frame BackgroundColor="Wheat"
                               BorderColor="{StaticResource GlassyBorder}"
                               CornerRadius="24"
                               Padding="24"
                               HasShadow="True"
                               MinimumHeightRequest="320">
                            <Frame.Shadow>
                                <Shadow Brush="Black"
                                        Offset="0,8"
                                        Radius="20"
                                        Opacity="0.12"/>
                            </Frame.Shadow>
                            <Frame.Effects>
                                <uranium:BlurEffect Mode="Light"
                                                    AccentOpacity="0.1"></uranium:BlurEffect>
                            </Frame.Effects>

                            <Grid>
                                <!-- REQUESTED State Content -->
                                <VerticalStackLayout Spacing="15"
                                                     IsVisible="{Binding TodaySession.Status, Converter={StaticResource StatusToBoolConverter}, ConverterParameter=REQUESTED}">
                                    <Label x:Name="GeneratingStatusLabel"
                                           Text="✨ Crafting your personalised meditation..."
                                           FontAttributes="Bold"
                                           FontSize="18"
                                           HorizontalOptions="Center"
                                           TextColor="Black"/>

                                    <!-- Glowing Orb for REQUESTED state -->
                                    <Grid HorizontalOptions="Center"
                                          VerticalOptions="Center"
                                          HeightRequest="150"
                                          WidthRequest="150">
                                        <GraphicsView x:Name="GlowingOrbGraphicsView"
                                                      HorizontalOptions="Center"
                                                      VerticalOptions="Center"
                                                      HeightRequest="150"
                                                      WidthRequest="150"
                                                      InputTransparent="True"/>
                                        <Image Source="logo.png"
                                               WidthRequest="100"
                                               HeightRequest="100"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center"
                                               InputTransparent="True"/>
                                    </Grid>
                                </VerticalStackLayout>

                                

                                <!-- FAILED State Content -->
                                <VerticalStackLayout Spacing="15"
                                                     IsVisible="{Binding TodaySession.Status, Converter={StaticResource StatusToBoolConverter}, ConverterParameter=FAILED}">
                                    <Label Text="Something went wrong"
                                           FontAttributes="Bold"
                                           FontSize="18"
                                           HorizontalOptions="Center"
                                           TextColor="Black"/>

                                    <Label Text="{Binding TodaySession.ErrorMessage}"
                                           FontSize="14"
                                           TextColor="{StaticResource Error}"
                                           HorizontalOptions="Center"
                                           HorizontalTextAlignment="Center"
                                           VerticalOptions="Center"
                                           HeightRequest="150"/>

                                    <!-- Enhanced Try Again Button with glassmorphism styling -->
                                    <Frame Padding="0"
                                           CornerRadius="25"
                                           HasShadow="True"
                                           HorizontalOptions="Center"
                                           HeightRequest="50"
                                           WidthRequest="200"
                                           BackgroundColor="{StaticResource Primary}"
                                           BorderColor="Transparent">
                                        <Frame.Shadow>
                                            <Shadow Brush="{StaticResource Primary}"
                                                    Offset="0,6"
                                                    Radius="15"
                                                    Opacity="0.25"/>
                                        </Frame.Shadow>
                                        <Button Text="🔄 Try Again"
                                                Command="{Binding RequestNewSessionCommand}"
                                                BackgroundColor="Transparent"
                                                TextColor="White"
                                                FontSize="16"
                                                FontAttributes="Bold"
                                                HorizontalOptions="Fill"
                                                VerticalOptions="Fill"
                                                BorderColor="Transparent"
                                                IsEnabled="{Binding IsRequestingSession, Converter={StaticResource InverseBoolConverter}}">
                                            <VisualStateManager.VisualStateGroups>
                                                <VisualStateGroupList>
                                                    <VisualStateGroup x:Name="CommonStates">
                                                        <VisualState x:Name="Normal">
                                                            <VisualState.Setters>
                                                                <Setter Property="Scale"
                                                                        Value="1.0"/>
                                                                <Setter Property="Opacity"
                                                                        Value="1.0"/>
                                                            </VisualState.Setters>
                                                        </VisualState>
                                                        <VisualState x:Name="Pressed">
                                                            <VisualState.Setters>
                                                                <Setter Property="Scale"
                                                                        Value="0.96"/>
                                                                <Setter Property="Opacity"
                                                                        Value="0.85"/>
                                                            </VisualState.Setters>
                                                        </VisualState>
                                                    </VisualStateGroup>
                                                </VisualStateGroupList>
                                            </VisualStateManager.VisualStateGroups>
                                            <Button.Behaviors>
                                                <toolkit:AnimationBehavior>
                                                    <toolkit:AnimationBehavior.AnimationType>
                                                        <toolkit:FadeAnimation Length="200"/>
                                                    </toolkit:AnimationBehavior.AnimationType>
                                                </toolkit:AnimationBehavior>
                                            </Button.Behaviors>
                                        </Button>
                                    </Frame>
                                </VerticalStackLayout>

                                <!-- COMPLETED State Content -->
                                <VerticalStackLayout Spacing="15"
                                                     IsVisible="{Binding TodaySession.Status, Converter={StaticResource StatusToBoolConverter}, ConverterParameter=COMPLETED}">

                                    <Label Text="Today's Meditation"
                                           FontAttributes="Bold"
                                           FontSize="18"
                                           HorizontalOptions="Center"
                                           TextColor="Black"/>

                                    <!-- Green Glowing Orb with Logo -->
                                    <Grid HorizontalOptions="Center"
                                          VerticalOptions="Center"
                                          HeightRequest="150"
                                          WidthRequest="150">
                                        <GraphicsView x:Name="CompletedOrbGraphicsView"
                                                      HorizontalOptions="Center"
                                                      VerticalOptions="Center"
                                                      HeightRequest="150"
                                                      WidthRequest="150"
                                                      InputTransparent="True"/>
                                        <Image Source="logo.png"
                                               WidthRequest="100"
                                               HeightRequest="100"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center"
                                               InputTransparent="True"/>
                                    </Grid>

                                    <!-- Play Button -->
                                    <Frame Padding="0"
                                           CornerRadius="25"
                                           HasShadow="True"
                                           HorizontalOptions="Center"
                                           HeightRequest="56"
                                           WidthRequest="200"
                                           BackgroundColor="{StaticResource Primary}"
                                           BorderColor="Transparent">
                                        <Frame.Shadow>
                                            <Shadow Brush="{StaticResource Primary}"
                                                    Offset="0,6"
                                                    Radius="15"
                                                    Opacity="0.25"/>
                                        </Frame.Shadow>
                                        <Button Text="Start Playing"
                                                Command="{Binding TogglePlaybackCommand}"
                                                BackgroundColor="Transparent"
                                                TextColor="White"
                                                FontSize="18"
                                                FontAttributes="Bold"
                                                HorizontalOptions="Fill"
                                                VerticalOptions="Fill"
                                                BorderColor="Transparent">
                                            <VisualStateManager.VisualStateGroups>
                                                <VisualStateGroupList>
                                                    <VisualStateGroup x:Name="CommonStates">
                                                        <VisualState x:Name="Normal">
                                                            <VisualState.Setters>
                                                                <Setter Property="Scale"
                                                                        Value="1.0"/>
                                                                <Setter Property="Opacity"
                                                                        Value="1.0"/>
                                                            </VisualState.Setters>
                                                        </VisualState>
                                                        <VisualState x:Name="Pressed">
                                                            <VisualState.Setters>
                                                                <Setter Property="Scale"
                                                                        Value="0.96"/>
                                                                <Setter Property="Opacity"
                                                                        Value="0.85"/>
                                                            </VisualState.Setters>
                                                        </VisualState>
                                                    </VisualStateGroup>
                                                </VisualStateGroupList>
                                            </VisualStateManager.VisualStateGroups>
                                            <Button.Behaviors>
                                                <toolkit:AnimationBehavior>
                                                    <toolkit:AnimationBehavior.AnimationType>
                                                        <toolkit:FadeAnimation Length="200"/>
                                                    </toolkit:AnimationBehavior.AnimationType>
                                                </toolkit:AnimationBehavior>
                                            </Button.Behaviors>
                                        </Button>
                                    </Frame>
                                </VerticalStackLayout>
                            </Grid>
                        </Frame>

                    </VerticalStackLayout>


                    <!-- If there's no session for today -->
                    <VerticalStackLayout Spacing="5"
                                         IsVisible="{Binding HasTodaySession, Converter={StaticResource InverseBoolConverter}}">

                        <!-- Enhanced Frame with glassmorphism styling matching buttons -->
                        <Frame BackgroundColor="{StaticResource GlassyWhite}"
                               BorderColor="{StaticResource GlassyBorder}"
                               CornerRadius="24"
                               Padding="20"
                               HasShadow="True"
                               MinimumHeightRequest="320">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnBackgroundTapped"/>
                            </Frame.GestureRecognizers>
                            <Frame.Shadow>
                                <Shadow Brush="Black"
                                        Offset="0,8"
                                        Radius="20"
                                        Opacity="0.12"/>
                            </Frame.Shadow>

                            <VerticalStackLayout Spacing="5"
                                                 VerticalOptions="Center">
                                <VerticalStackLayout.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnBackgroundTapped"/>
                                </VerticalStackLayout.GestureRecognizers>
                                <!-- Header with icon -->
                                <VerticalStackLayout Spacing="8"
                                                     HorizontalOptions="Center">
                                    <VerticalStackLayout.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnBackgroundTapped"/>
                                    </VerticalStackLayout.GestureRecognizers>
                                    <Image Source="logo.png"
                                           WidthRequest="50"
                                           HeightRequest="50"
                                           HorizontalOptions="Center"
                                           Margin="0,0,0,-10"/>
                                    <Label Text="Create Your Daily Session"
                                           FontSize="22"
                                           FontAttributes="Bold"
                                           HorizontalOptions="Center"
                                           TextColor="Black"
                                           Margin="0,0,0,10"/>
                                </VerticalStackLayout>

                                <!-- Notes input with enhanced styling -->
                                <VerticalStackLayout Spacing="10">
                                    <VerticalStackLayout.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnBackgroundTapped"/>
                                    </VerticalStackLayout.GestureRecognizers>


                                    <Frame BackgroundColor="{StaticResource GlassyBlue}"
                                           BorderColor="{StaticResource GlassyBorder}"
                                           CornerRadius="18"
                                           Padding="5"
                                           Margin="0,0,0,10"
                                           HasShadow="False">
                                        <Editor x:Name="SessionNotesEditor"
                                                Text="{Binding SessionNotes}"
                                                Placeholder="Share your thoughts and feelings as if writing in a diary. How are you today, and what’s been happening in your life?"                                                PlaceholderColor="#A0A0A0"
                                                HeightRequest="100"
                                                BackgroundColor="Transparent"
                                                FontSize="16"
                                                VerticalOptions="Start"/>
                                    </Frame>
                                </VerticalStackLayout>

                                <!-- Enhanced Create Button with glassmorphism styling -->
                                <Frame Padding="0"
                                       CornerRadius="25"
                                       HasShadow="True"
                                       HorizontalOptions="Fill"
                                       HeightRequest="56"
                                       BackgroundColor="{StaticResource Primary}"
                                       BorderColor="Transparent">
                                    <Frame.Shadow>
                                        <Shadow Brush="{StaticResource Primary}"
                                                Offset="0,6"
                                                Radius="15"
                                                Opacity="0.25"/>
                                    </Frame.Shadow>
                                    <Button Text="✨ Create My Meditation"
                                            Command="{Binding RequestNewSessionCommand}"
                                            BackgroundColor="Transparent"
                                            TextColor="White"
                                            FontSize="18"
                                            FontAttributes="Bold"
                                            HorizontalOptions="Fill"
                                            VerticalOptions="Fill"
                                            BorderColor="Transparent">
                                        <VisualStateManager.VisualStateGroups>
                                            <VisualStateGroupList>
                                                <VisualStateGroup x:Name="CommonStates">
                                                    <VisualState x:Name="Normal">
                                                        <VisualState.Setters>
                                                            <Setter Property="Scale"
                                                                    Value="1.0"/>
                                                            <Setter Property="Opacity"
                                                                    Value="1.0"/>
                                                        </VisualState.Setters>
                                                    </VisualState>
                                                    <VisualState x:Name="Pressed">
                                                        <VisualState.Setters>
                                                            <Setter Property="Scale"
                                                                    Value="0.96"/>
                                                            <Setter Property="Opacity"
                                                                    Value="0.85"/>
                                                        </VisualState.Setters>
                                                    </VisualState>
                                                </VisualStateGroup>
                                            </VisualStateGroupList>
                                        </VisualStateManager.VisualStateGroups>
                                        <Button.Behaviors>
                                            <toolkit:AnimationBehavior>
                                                <toolkit:AnimationBehavior.AnimationType>
                                                    <toolkit:FadeAnimation Length="200"/>
                                                </toolkit:AnimationBehavior.AnimationType>
                                            </toolkit:AnimationBehavior>
                                        </Button.Behaviors>
                                    </Button>
                                </Frame>
                            </VerticalStackLayout>
                        </Frame>
                    </VerticalStackLayout>

                </VerticalStackLayout>

                <!-- Mood Chart -->
                <controls:MoodChartView MoodData="{Binding MoodData}"/>

                

            </VerticalStackLayout>
        </ScrollView>

    </Grid>

    <!-- Audio Player Bottom Sheet -->
    <uranium:UraniumContentPage.Attachments>
        <material:BottomSheetView x:Name="AudioPlayerBottomSheet"
                                  IsPresented="{Binding IsAudioPlayerSheetOpen, Mode=TwoWay}"
                                  DisablePageWhenOpened="False"
                                  CloseOnTapOutside="True"
                                  BackgroundColor="Transparent"
                                  Margin="0,0,0,10">
            <material:BottomSheetView.Header>
                <!-- Custom Header with Handle and Metadata -->
                <Border StrokeShape="RoundRectangle 32"
                        Margin="16,0,16,0"
                        Padding="0">
                    <Border.GestureRecognizers>
                        <PanGestureRecognizer PanUpdated="OnHeaderPanUpdated"/>
                    </Border.GestureRecognizers>
                    <VerticalStackLayout
                        Margin="0">
                        <VerticalStackLayout.Effects>
                            <uranium:BlurEffect Mode="Light"
                                                AccentOpacity="0.9"/>
                        </VerticalStackLayout.Effects>

                        <Grid RowDefinitions="Auto,Auto"
                              Padding="20,0,20,0"
                              Margin="0">
                            <!-- Metadata Section -->
                            <Grid Grid.Row="1"
                                  ColumnDefinitions="*,Auto,50"
                                  ColumnSpacing="15"
                                  Padding="0">
                                <!-- Session Info -->
                                <VerticalStackLayout Grid.Column="0"
                                                     Spacing="4"
                                                     VerticalOptions="Center">
                                    <Label Text="{Binding SessionDateText}"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           TextColor="Black"/>
                                    <Label Text="Meditation Session"
                                           FontSize="12"
                                           TextColor="Gray"/>
                                </VerticalStackLayout>

                                <!-- Play/Pause Button -->
                                <ImageButton Source="{Binding PlayPauseIconImage}"
                                             Command="{Binding TogglePlaybackCommand}"
                                             BackgroundColor="Transparent"
                                             Grid.Column="2"
                                             WidthRequest="80"
                                             HeightRequest="80"
                                             BorderColor="Transparent"/>





                            </Grid>
                        </Grid>
                    </VerticalStackLayout>
                </Border>
            </material:BottomSheetView.Header>

            <!-- Bottom Sheet Content -->
            <controls:AudioPlayerBottomSheet/>
        </material:BottomSheetView>
    </uranium:UraniumContentPage.Attachments>
</uranium:UraniumContentPage>